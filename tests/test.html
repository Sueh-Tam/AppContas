<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Testes App Contas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="p-4">
    <h1 class="h4 mb-3">Testes Automatizados (básicos)</h1>
    <div id="results" class="list-group"></div>

    <script type="module">
      import { DataStore } from '/public/js/dataStore.js';
      const resultsEl = document.getElementById('results');
      const addResult = (text, ok) => {
        const li = document.createElement('div');
        li.className = `list-group-item list-group-item-${ok ? 'success' : 'danger'}`;
        li.textContent = text;
        resultsEl.appendChild(li);
      };

      const store = new DataStore();
      await store.init();

      // Teste 1: leitura inicial
      addResult('Leitura inicial de contas >= 0 itens', store.getContas().length >= 0);

      // Teste 2: persistência local
      const lenBefore = store.getContas().length;
      store.addConta({ data: '2025-03-01', descricao: 'Teste persistência', local: 'Local X', categoria: 'Mercado', valor: 10 });
      await store.persist();
      const store2 = new DataStore();
      await store2.init();
      addResult('Persistência no localStorage funciona', store2.getContas().length === lenBefore + 1);

      // Teste 3: validação básica de dados (deve lançar ao adicionar inválido)
      let threw = false;
      try {
        store.addConta({ data: '', descricao: '', local: '', valor: NaN });
      } catch (_) { threw = true; }
      addResult('Validação rejeita conta inválida', threw);

      // Responsividade é visual; instrução manual
      addResult('Responsividade: verificar manualmente com DevTools', true);
    </script>
  </body>
  </html>